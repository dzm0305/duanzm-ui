{"remainingRequest":"/Users/duanzhimin/Java/MyWorkspaces/duanzm-ui/node_modules/babel-loader/lib/index.js!/Users/duanzhimin/Java/MyWorkspaces/duanzm-ui/node_modules/eslint-loader/index.js??ref--13-0!/Users/duanzhimin/Java/MyWorkspaces/duanzm-ui/src/permission.js","dependencies":[{"path":"/Users/duanzhimin/Java/MyWorkspaces/duanzm-ui/src/permission.js","mtime":1632969595118},{"path":"/Users/duanzhimin/Java/MyWorkspaces/duanzm-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/duanzhimin/Java/MyWorkspaces/duanzm-ui/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/duanzhimin/Java/MyWorkspaces/duanzm-ui/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCIvVXNlcnMvZHVhbnpoaW1pbi9KYXZhL015V29ya3NwYWNlcy9kdWFuem0tdWkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0IikuZGVmYXVsdDsKCnZhciBfb2JqZWN0U3ByZWFkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiL1VzZXJzL2R1YW56aGltaW4vSmF2YS9NeVdvcmtzcGFjZXMvZHVhbnptLXVpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFNwcmVhZDIiKSk7Cgp2YXIgX3JvdXRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiLi9yb3V0ZXIiKSk7Cgp2YXIgX3N0b3JlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCIuL3N0b3JlIikpOwoKdmFyIF9lbGVtZW50VWkgPSByZXF1aXJlKCJlbGVtZW50LXVpIik7Cgp2YXIgX25wcm9ncmVzcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibnByb2dyZXNzIikpOwoKcmVxdWlyZSgibnByb2dyZXNzL25wcm9ncmVzcy5jc3MiKTsKCnZhciBfYXV0aCA9IHJlcXVpcmUoIkAvdXRpbHMvYXV0aCIpOwoKLy9hdXRo5paH5Lu25Li76KaB5L6d6LWWanMtY29va2ll5qih5Z2X77yM5oqKZ2V0VG9rZW7vvIxzZXRUb2tlbu+8jHJlbW92ZVRva2Vu6K6+572u5Zyo6L+Z6YeMCi8vTlByb2dyZXNz5piv5bCB6KOF55qE6L+b5bqm5p2h77yM5Z+65pys5LiN55So5YqoCl9ucHJvZ3Jlc3MuZGVmYXVsdC5jb25maWd1cmUoewogIHNob3dTcGlubmVyOiBmYWxzZQp9KTsgLy/ot6/nlLHnmb3lkI3ljZXliJfooajvvIzmiorot6/nlLHmt7vliqDliLDov5nkuKrmlbDnu4TvvIzkuI3nlKjnmbvpmYbkuZ/lj6/ku6Xorr/pl64KCgp2YXIgd2hpdGVMaXN0ID0gWycvbG9naW4nLCAnL2F1dGgtcmVkaXJlY3QnLCAnL2JpbmQnLCAnL3JlZ2lzdGVyJ107Cgpfcm91dGVyLmRlZmF1bHQuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICAvLyDor7fmsYLot6/nlLHml7bov5vluqbmnaHlvIDlp4sKICBfbnByb2dyZXNzLmRlZmF1bHQuc3RhcnQoKTsgLy8g6L+Z6YeM55qEZ2V0VG9rZW4oKeWwseaYr+WcqOS4iumdouWvvOWFpeeahGF1dGguanPph4znmoRnZXRUb2tlbigp5pa55rOVLOWmguaenOWtmOWcqHRva2Vu77yM5Y2z5a2Y5Zyo5bey55m76ZmG55qE5Luk54mMCgoKICBpZiAoKDAsIF9hdXRoLmdldFRva2VuKSgpKSB7CiAgICB0by5tZXRhLnRpdGxlICYmIF9zdG9yZS5kZWZhdWx0LmRpc3BhdGNoKCdzZXR0aW5ncy9zZXRUaXRsZScsIHRvLm1ldGEudGl0bGUpOyAvL+WmguaenOeUqOaIt+WtmOWcqOS7pOeJjOeahOaDheWGteivt+axgueZu+W9lemhtemdou+8jOWwseiuqeeUqOaIt+ebtOaOpei3s+i9rOWIsOmmlumhte+8jOmBv+WFjeWtmOWcqOmHjeWkjeeZu+W9leeahOaDheWGtQoKICAgIGlmICh0by5wYXRoID09PSAnL2xvZ2luJykgewogICAgICBuZXh0KHsKICAgICAgICBwYXRoOiAnLycKICAgICAgfSk7IC8v5LiA5a6a6KaB5YWz6Zet6L+b5bqm5p2hCgogICAgICBfbnByb2dyZXNzLmRlZmF1bHQuZG9uZSgpOwogICAgfSBlbHNlIHsKICAgICAgLy/lpoLmnpzlt7Lnu4/mnInku6TniYznmoTnlKjmiLfor7fmsYLnmoTkuI3mmK/nmbvlvZXpobXvvIzmmK/lhbbku5bpobXpnaLjgILlsLHku45WdWV46YeM5ou/5Yiw55So5oi355qE5L+h5oGv77yM6L+Z6YeM5Lmf6K+B5piO55So5oi35LiN5piv56ys5LiA5qyh55m75b2V5LqGLOmAmui/h1Z1ZXjorr7nva7nlKjmiLfkv6Hmga8KICAgICAgaWYgKF9zdG9yZS5kZWZhdWx0LmdldHRlcnMucm9sZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgLy8g5Yik5pat5b2T5YmN55So5oi35piv5ZCm5bey5ouJ5Y+W5a6MdXNlcl9pbmZv5L+h5oGvLOiuv+mXriBAc3RvcmUvbW9kdWxlcy91c2VyLmpz5LiL55qEIEdldEluZm8KICAgICAgICBfc3RvcmUuZGVmYXVsdC5kaXNwYXRjaCgnR2V0SW5mbycpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgLy/orr/pl64gQHN0b3JlL21vZHVsZXMvcGVybWlzc2lvbi5qc+S4i+eahCBHZXRJbmZvCiAgICAgICAgICBfc3RvcmUuZGVmYXVsdC5kaXNwYXRjaCgnR2VuZXJhdGVSb3V0ZXMnKS50aGVuKGZ1bmN0aW9uIChhY2Nlc3NSb3V0ZXMpIHsKICAgICAgICAgICAgLy8g5qC55o2ucm9sZXPmnYPpmZDnlJ/miJDlj6/orr/pl67nmoTot6/nlLHooagKICAgICAgICAgICAgX3JvdXRlci5kZWZhdWx0LmFkZFJvdXRlcyhhY2Nlc3NSb3V0ZXMpOyAvLyDliqjmgIHmt7vliqDlj6/orr/pl67ot6/nlLHooagKCgogICAgICAgICAgICBuZXh0KCgwLCBfb2JqZWN0U3ByZWFkMi5kZWZhdWx0KSgoMCwgX29iamVjdFNwcmVhZDIuZGVmYXVsdCkoe30sIHRvKSwge30sIHsKICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgICAgIH0pKTsgLy8gaGFja+aWueazlSDnoa7kv51hZGRSb3V0ZXPlt7LlrozmiJAKICAgICAgICAgIH0pOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIF9zdG9yZS5kZWZhdWx0LmRpc3BhdGNoKCdMb2dPdXQnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX2VsZW1lbnRVaS5NZXNzYWdlLmVycm9yKGVycik7CgogICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICBwYXRoOiAnLycKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBuZXh0KCk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgLy8g5rKh5pyJdG9rZW4sIHdoaXRlTGlzdC5pbmRleE9mKHRvLnBhdGgpICE9PSAtMSnliKTmlq3nlKjmiLfor7fmsYLnmoTot6/nlLHmmK/lkKblnKjnmb3lkI3ljZXph4wKICAgIGlmICh3aGl0ZUxpc3QuaW5kZXhPZih0by5wYXRoKSAhPT0gLTEpIHsKICAgICAgLy8g5LiN5pivLTHlsLHor4HmmI7lnKjlhY3nmbvlvZXnmb3lkI3ljZXvvIzkuI3nrqHkvaDmnInmsqHmnInku6TniYzvvIzpg73nm7TmjqXljrvliLDnmb3lkI3ljZXot6/nlLHlr7nlupTnmoTpobXpnaIKICAgICAgbmV4dCgpOwogICAgfSBlbHNlIHsKICAgICAgbmV4dCgiL2xvZ2luP3JlZGlyZWN0PSIuY29uY2F0KHRvLmZ1bGxQYXRoKSk7IC8vIOWQpuWImeWFqOmDqOmHjeWumuWQkeWIsOeZu+W9lemhtQoKICAgICAgX25wcm9ncmVzcy5kZWZhdWx0LmRvbmUoKTsKICAgIH0KICB9Cn0pOwoKX3JvdXRlci5kZWZhdWx0LmFmdGVyRWFjaChmdW5jdGlvbiAoKSB7CiAgLy/mr4/mrKHor7fmsYLnu5PmnZ/lkI7pg73pnIDopoHlhbPpl63ov5vluqbmnaEKICBfbnByb2dyZXNzLmRlZmF1bHQuZG9uZSgpOwp9KTs="},{"version":3,"sources":["/Users/duanzhimin/Java/MyWorkspaces/duanzm-ui/src/permission.js"],"names":["NProgress","configure","showSpinner","whiteList","router","beforeEach","to","from","next","start","meta","title","store","dispatch","path","done","getters","roles","length","then","accessRoutes","addRoutes","replace","catch","err","Message","error","indexOf","fullPath","afterEach"],"mappings":";;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AADA;AAGA;AACAA,mBAAUC,SAAV,CAAoB;AAAEC,EAAAA,WAAW,EAAE;AAAf,CAApB,E,CAEA;;;AACA,IAAMC,SAAS,GAAG,CAAC,QAAD,EAAW,gBAAX,EAA6B,OAA7B,EAAsC,WAAtC,CAAlB;;AAEAC,gBAAOC,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACpC;AACAR,qBAAUS,KAAV,GAFoC,CAGpC;;;AACA,MAAI,qBAAJ,EAAgB;AACdH,IAAAA,EAAE,CAACI,IAAH,CAAQC,KAAR,IAAiBC,eAAMC,QAAN,CAAe,mBAAf,EAAoCP,EAAE,CAACI,IAAH,CAAQC,KAA5C,CAAjB,CADc,CAEd;;AACA,QAAIL,EAAE,CAACQ,IAAH,KAAY,QAAhB,EAA0B;AACxBN,MAAAA,IAAI,CAAC;AAAEM,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAJ,CADwB,CAExB;;AACAd,yBAAUe,IAAV;AACD,KAJD,MAIO;AACL;AACA,UAAIH,eAAMI,OAAN,CAAcC,KAAd,CAAoBC,MAApB,KAA+B,CAAnC,EAAsC;AACpC;AACAN,uBAAMC,QAAN,CAAe,SAAf,EAA0BM,IAA1B,CAA+B,YAAM;AACnC;AACAP,yBAAMC,QAAN,CAAe,gBAAf,EAAiCM,IAAjC,CAAsC,UAAAC,YAAY,EAAI;AACpD;AACAhB,4BAAOiB,SAAP,CAAiBD,YAAjB,EAFoD,CAErB;;;AAC/BZ,YAAAA,IAAI,6DAAMF,EAAN;AAAUgB,cAAAA,OAAO,EAAE;AAAnB,eAAJ,CAHoD,CAGrB;AAChC,WAJD;AAKD,SAPD,EAOGC,KAPH,CAOS,UAAAC,GAAG,EAAI;AACZZ,yBAAMC,QAAN,CAAe,QAAf,EAAyBM,IAAzB,CAA8B,YAAM;AAClCM,+BAAQC,KAAR,CAAcF,GAAd;;AACAhB,YAAAA,IAAI,CAAC;AAAEM,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAJ;AACD,WAHD;AAID,SAZH;AAaD,OAfD,MAeO;AACLN,QAAAA,IAAI;AACL;AACF;AACF,GA5BD,MA4BO;AACL;AACA,QAAIL,SAAS,CAACwB,OAAV,CAAkBrB,EAAE,CAACQ,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACrC;AACAN,MAAAA,IAAI;AACL,KAHD,MAGO;AACLA,MAAAA,IAAI,2BAAoBF,EAAE,CAACsB,QAAvB,EAAJ,CADK,CACkC;;AACvC5B,yBAAUe,IAAV;AACD;AACF;AACF,CA1CD;;AA4CAX,gBAAOyB,SAAP,CAAiB,YAAM;AACrB;AACA7B,qBAAUe,IAAV;AACD,CAHD","sourcesContent":["import router from './router'\r\nimport store from './store'\r\nimport { Message } from 'element-ui'\r\nimport NProgress from 'nprogress'\r\nimport 'nprogress/nprogress.css'\r\n//auth文件主要依赖js-cookie模块，把getToken，setToken，removeToken设置在这里\r\nimport { getToken } from '@/utils/auth'\r\n\r\n//NProgress是封装的进度条，基本不用动\r\nNProgress.configure({ showSpinner: false })\r\n\r\n//路由白名单列表，把路由添加到这个数组，不用登陆也可以访问\r\nconst whiteList = ['/login', '/auth-redirect', '/bind', '/register']\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n  // 请求路由时进度条开始\r\n  NProgress.start()\r\n  // 这里的getToken()就是在上面导入的auth.js里的getToken()方法,如果存在token，即存在已登陆的令牌\r\n  if (getToken()) {\r\n    to.meta.title && store.dispatch('settings/setTitle', to.meta.title)\r\n    //如果用户存在令牌的情况请求登录页面，就让用户直接跳转到首页，避免存在重复登录的情况\r\n    if (to.path === '/login') {\r\n      next({ path: '/' })\r\n      //一定要关闭进度条\r\n      NProgress.done()\r\n    } else {\r\n      //如果已经有令牌的用户请求的不是登录页，是其他页面。就从Vuex里拿到用户的信息，这里也证明用户不是第一次登录了,通过Vuex设置用户信息\r\n      if (store.getters.roles.length === 0) {\r\n        // 判断当前用户是否已拉取完user_info信息,访问 @store/modules/user.js下的 GetInfo\r\n        store.dispatch('GetInfo').then(() => {\r\n          //访问 @store/modules/permission.js下的 GetInfo\r\n          store.dispatch('GenerateRoutes').then(accessRoutes => {\r\n            // 根据roles权限生成可访问的路由表\r\n            router.addRoutes(accessRoutes) // 动态添加可访问路由表\r\n            next({ ...to, replace: true }) // hack方法 确保addRoutes已完成\r\n          })\r\n        }).catch(err => {\r\n            store.dispatch('LogOut').then(() => {\r\n              Message.error(err)\r\n              next({ path: '/' })\r\n            })\r\n          })\r\n      } else {\r\n        next()\r\n      }\r\n    }\r\n  } else {\r\n    // 没有token, whiteList.indexOf(to.path) !== -1)判断用户请求的路由是否在白名单里\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      // 不是-1就证明在免登录白名单，不管你有没有令牌，都直接去到白名单路由对应的页面\r\n      next()\r\n    } else {\r\n      next(`/login?redirect=${to.fullPath}`) // 否则全部重定向到登录页\r\n      NProgress.done()\r\n    }\r\n  }\r\n})\r\n\r\nrouter.afterEach(() => {\r\n  //每次请求结束后都需要关闭进度条\r\n  NProgress.done()\r\n})\r\n"]}]}